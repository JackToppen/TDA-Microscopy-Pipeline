---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r libraries}
library(FNN)
library(TDA)
source("utilities.R")
source("config.R")
```

```{r data}
#lim <- c(c(712.5*1, 712.5*2), c(712.5*1,712.5*2))
i <- 107 
k <- 10 #patch    
all_cells <- read.csv(file=paste0(data_file_location,data_filenames[[i]]), header=TRUE)
all_cells <- all_cells[which ((712.5*1) <= all_cells[,1] & all_cells[,1] <= (712.5*2) & (712.5*2)  <= all_cells[,2] & all_cells[,2] <= (712.5*3)),]
red_cells <- all_cells[ which(all_cells[,8]==1), ]  
PH <- alphaComplexDiag(red_cells[,1:2], library = c("GUDHI", "Dionysus"), location = TRUE, printProgress = TRUE)
PD <- gudhi2tdatools(PH$diagram) 
PD$pairs[[2]] <- sqrt(PD$pairs[[2]])
#red cells  
  #green_cells <- all_cells[ which(all_cells[,8]==1 & all_cells[,9]==0), ]      #green cells  
  #pos_cells <- all_cells[ which(all_cells[,8]==1 & all_cells[,9]==1), ]      #green cells  
  #neg_cells <- all_cells[ which(all_cells[,8]==0 & all_cells[,9]==0), ]      #green cells  
  par(pty="s", pch=20)
  plot(red_cells[,1:2],type = 'p', 
   ylab="", xlab="", axes = FALSE, col = "black", pch=20, cex=0.5)
  #plot(green_cells[,1:2], type = 'p', xlim = lim[1:2], ylim = lim[3:4],
  # ylab="", xlab="", axes = FALSE, col = "green", pch=20, cex=0.5)
  #plot(pos_cells[,1:2], type = 'p', xlim = lim[1:2], ylim = lim[3:4],
  # ylab="", xlab="", axes = FALSE, col = "orange", pch=20, cex=0.5)
  #plot(neg_cells[,1:2], type = 'p', xlim = lim[1:2], ylim = lim[3:4],
   #ylab="", xlab="", axes = FALSE, col = "blue", pch=20, cex=0.5)
```
```{r PDs}
par(pty="s", font.axis=1.7, cex.axis=1)
i <- 56 
k <- 16 
plot_diagram(PDs[[i]][[k]]$pairs[[2]])
abline(20.5, 1, col = adjustcolor("gray", alpha = 0.8), lwd=1)
abline(5.5, 1, col = adjustcolor("brown", alpha = 0.4), lwd=1)
for (j in 1:nrow(PDs[[i]][[k]]$pairs[[2]])){
  if ((PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] >= 26.6) & (PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] < 26.4)  ){
    print("purple")
    print(PDs[[i]][[k]]$pairs[[2]][j,2])
    print(PDs[[i]][[k]]$pairs[[2]][j,1])
    #print(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1])
    points(x=PDs[[i]][[k]]$pairs[[2]][j,1], y=PDs[[i]][[k]]$pairs[[2]][j,2], col="darkorchid1", pch=20, cex=1)
  }
  if ((PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] < 26.6) &(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] >= 26.6) ){
     print("palegreen")
    print(PDs[[i]][[k]]$pairs[[2]][j,2])
    print(PDs[[i]][[k]]$pairs[[2]][j,1])
    #print(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1])
    points(x=PDs[[i]][[k]]$pairs[[2]][j,1], y=PDs[[i]][[k]]$pairs[[2]][j,2], col="darkorchid1", pch=20, cex=1)
  }
  if ((PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] < 26.8) &(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] >= 24) ){
     print("green")
    print(PDs[[i]][[k]]$pairs[[2]][j,2])
    print(PDs[[i]][[k]]$pairs[[2]][j,1])
    #print(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1])
    points(x=PDs[[i]][[k]]$pairs[[2]][j,1], y=PDs[[i]][[k]]$pairs[[2]][j,2], col="darkorchid1", pch=20, cex=1)
  }
   if ((PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] >= 26.8) & (PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] < 30)  ){
    print("forestgreen")
    print(PDs[[i]][[k]]$pairs[[2]][j,2])
    print(PDs[[i]][[k]]$pairs[[2]][j,1])
     print(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1])
    points(x=PDs[[i]][[k]]$pairs[[2]][j,1], y=PDs[[i]][[k]]$pairs[[2]][j,2], col="chartreuse3", pch=20, cex=1)
  } 
  if ((PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1] >= 30)  ){
    print("blue")
    print(PDs[[i]][[k]]$pairs[[2]][j,2])
    print(PDs[[i]][[k]]$pairs[[2]][j,1])
    #print(PDs[[i]][[k]]$pairs[[2]][j,2]-PDs[[i]][[k]]$pairs[[2]][j,1])
    points(x=PDs[[i]][[k]]$pairs[[2]][j,1], y=PDs[[i]][[k]]$pairs[[2]][j,2], col="blue", pch=20, cex=1)
  } 
}
```

```{r PLs}
par(pty="s", font.axis=1.7, cex.axis=1, xaxp = c(0,100,50))
plot_landscape_levels(PLs[[56]][[16]], 1, max_PL_depth)
points((13.32722  +39.58218  )/2, (-13.32722  +39.58218  )/2, col = "darkorchid1", pch=20, cex=1)
points((11.65526   +38.45607   )/2, (-11.55   +38.45607 )/2, col = "chartreuse3", pch=20, cex=1)

plot_landscape_levels(PLs[[107]][[10]], 1, max_PL_depth)
points((9.155577  +29.77414  )/2, (-9.155577  +29.77414  )/2, col = "darkorchid1", pch=20, cex=1)
points((13.47307   +39.14549   )/2, (-13.47307   +39.14549 )/2, col = "chartreuse3", pch=20, cex=1)
points((12.3826  +45.94782   )/2, (-12.3826  +45.3  )/2, col = "blue", pch=20, cex=1)

plot_landscape_levels(PLs[[49]][[14]], 1, max_PL_depth)
points((10.39667  +30.53212  )/2, (-10.39667  +30.53212  )/2, col = "darkorchid1", pch=20, cex=1)
points((9.500024   +37.40864   )/2, (-9.500024   +37.40864 )/2, col = "chartreuse3", pch=20, cex=1)

plot_landscape_levels(PLs[[53]][[4]], 1, max_PL_depth)
points((10.05543   +30.48007  )/2, (-10.05543   +30.48007  )/2, col = "darkorchid1", pch=20, cex=1)
points((15.80139   +42.00211    )/2, (-15.80139   +42.00211  )/2, col = "chartreuse3", pch=20, cex=1)

plot_landscape_levels(PLs[[108]][[11]], 1, max_PL_depth)
points((10.41406  +43.24945   )/2, (-10.41406  +43.24945   )/2, col = "blue", pch=20, cex=1)
points((8.798681    +35.96211   )/2, (-8.798681    +35.96211 )/2, col = "chartreuse3", pch=20, cex=1)
points((6.759174     +28.44515    )/2, (-6.759174    +28.44515    )/2, col = "darkorchid1", pch=20, cex=1)

plot_landscape_levels(PLs[[107]][[3]], 1, max_PL_depth)
points((9.415558  +40.72747   )/2, (-9.415558  +40.72747   )/2, col = "blue", pch=20, cex=1)
points((17.11993   +42.45173   )/2, (-17.11993   +42.45173 )/2, col = "chartreuse3", pch=20, cex=1)
points((15.02556    +35.9737     )/2, (-15.02556   +35.9737     )/2, col = "darkorchid1", pch=20, cex=1)

plot_landscape_levels(PLs[[119]][[8]], 1, max_PL_depth)
points((7.335106  +39.24209   )/2, (-7.335106  +39.24209   )/2, col = "blue", pch=20, cex=1)
points((12.21353  +38.08285   )/2, (-12.21353  +38.08285   )/2, col = "forestgreen", pch=20, cex=1)
points((8.93667  +34.56924  )/2, (-8.93667  +34.56924   )/2, col = "chartreuse3", pch=20, cex=1)
points((7.294845   +32.89413   )/2, (-7.294845   +32.89413    )/2, col = "palegreen2", pch=20, cex=1)
points((7.89    +28.2606      )/2, (-7.89    +28.2606     )/2, col = "darkorchid1", pch=20, cex=1)
```
```{r PLs}
par(pty="s")
plot_landscape_levels(PLs[[49]][[14]], 1, max_PL_depth)
points((8.815508  +26.22365   )/2, (-8.815508  +26.22365   )/2, col = "darkorchid1", pch=20, cex=0.8)
points((10.24893  +25.85956   )/2, (-10.24893  +25.85956  )/2, col = "darkorchid1", pch=20, cex=0.8)
points((10.85046    +27.7695     )/2, (-10.85046    +27.7695     )/2, col = "darkorchid1", pch=20, cex=0.8)
points((12.66018   +27.8027    )/2, (-12.66018   +27.8027    )/2, col = "darkorchid1", pch=20, cex=0.8)
points((18.50936   +45.84135   )/2, (-18.50936   +45.84135  )/2, col = "chartreuse3", pch=20, cex=0.8)
points((22.67251   +40.22844    )/2, (-22.67251   +40.22844    )/2, col = "chartreuse3", pch=20, cex=0.8)

plot_landscape_levels(PLs[[114]][[6]], 1, max_PL_depth)
points((9.895629  +26.8287   )/2, (-9.895629  +26.8287  )/2, col = "darkorchid1", pch=20, cex=0.8)
points((11.51542 +30.33208   )/2, (-11.51542 +30.33208   )/2, col = "chartreuse3", pch=20, cex=0.8)
points((13.96567  +32.76623   )/2, (-13.96567  +32.76623   )/2, col = "chartreuse3", pch=20, cex=0.8)
points((12.04621 +33.24911  )/2, (-12.04621 +33.24911  )/2, col = "chartreuse3", pch=20, cex=0.8)
points((12.71494 +33.97885  )/2, (-12.71494 +33.97885  )/2, col = "chartreuse3", pch=20, cex=0.8)
points((10.44737 +41.64694  )/2, (-10.44737 +41.64694  )/2, col = "blue", pch=20, cex=0.8)

plot_landscape_levels(PLsum(PLs[[57]][[7]],PLscale(-1, PLs[[114]][[6]])), 1, max_PL_depth)
#plot_landscape_levels(PLs_avg[[1]][[4]], 1, max_PL_depth)
#plot_landscape_levels(PLs_avg[[2]][[4]], 1, max_PL_depth)
#plot_landscape_levels(PLsum(PLs_avg[[1]][[4]],PLscale(-1,PLs_avg[[2]][[4]])), 1, max_PL_depth)

plot_landscape_levels(PLs[[53]][[9]], 1, max_PL_depth)
plot_landscape_levels(PLs[[49]][[14]], 1, max_PL_depth)
```

```{r representative-cycles}
par(pty="s", pch=20, cex=0.5)
#point cloud
filtration <- alphaComplexFiltration((red_cells[,1:2]), printProgress = TRUE)
PH_red <- alphaComplexDiag(red_cells[,1:2], maxdimension = 1, library = c("GUDHI", "Dionysus"), location = TRUE, printProgress = TRUE)
PD <- PH_red[["diagram"]]
PH <- PH_red
      #lim <- c(c(712.5*(j-1), 712.5*j), c(712.5*(k-1),712.5*k))
par(mfrow = c(1, 1))
ones <- which(PD[,1] == 1)
if (length(ones) > 1 ){
  #plot(NULL, type = "o", xlim = lim[1:2], ylim = lim[3:4], ylab="", xlab="", axes = FALSE)
         #points(filtration[["coordinates"]], pch = 20, cex=0.5)
plot(filtration[["coordinates"]], pch = 20, cex=0.5, ylab="", xlab="", axes = FALSE)
         title(main=sprintf("file %1.0f",i)) 
         for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2])  >= 20) & (sqrt(PD[m,3]) - sqrt(PD[m,2]) < 22) ){
              print(sqrt(PD[m,2]))
              print(sqrt(PD[m,3]))
              print(sprintf("persistence: %1.0f", sqrt(PD[m,3]) - sqrt(PD[m,2])))
              for (s in 1:length(cycles)){
                for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="darkorchid1", lwd=2)
                }
              } 
            } 
         }
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) < 25) & (sqrt(PD[m,3]) - sqrt(PD[m,2])  >= 22) ){
              print(sqrt(PD[m,2]))
              print(sqrt(PD[m,3]))
              print(sprintf("persistence: %1.0f", sqrt(PD[m,3]) - sqrt(PD[m,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="palegreen", lwd=2)
                } 
              } 
           } 
         } 
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2])  < 26.8) & (sqrt(PD[m,3]) - sqrt(PD[m,2])  >= 25) ){
          #print(sqrt(PD[m,2]))
          #print(sqrt(PD[m,3]))
          print(sprintf("persistence: %1.0f", sqrt(PD[m,3]) - sqrt(PD[m,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="chartreuse3", lwd=2)
                } 
              } 
           } 
        } 
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2])  < 30) & (sqrt(PD[m,3]) - sqrt(PD[m,2])  >= 26.8) ){
          #print(sqrt(PD[m,2]))
          #print(sqrt(PD[m,3]))
          print(sprintf("persistence: %1.0f", sqrt(PD[m,3]) - sqrt(PD[m,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="chartreuse3", lwd=2)
                } 
              } 
           } 
         } 
         for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2])  >= 30) ){
          #print(sqrt(PD[m,2]))
          #print(sqrt(PD[m,3]))
          print(sprintf("persistence: %1.0f", sqrt(PD[m,3]) - sqrt(PD[m,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="blue", lwd=2)
                } 
              } 
           } 
         } 
 }
```

```{r GATA6}
par(pty="s", pch=20, cex=0.5)
#point cloud
for (i in 46:60){
  #print(data_filenames[[i]])
  for (k in 1:sqrt(npatches)){ #y-axis
    for (j in 1:sqrt(npatches)){ #x-axis
      #every image is approximately 2850x2850 
      all_cells <- read.csv(file=paste0(data_file_location,data_filenames[[i]]), header=TRUE)
      all_cells <- all_cells[which( (2850/sqrt(npatches))*(j-1) <= all_cells[,1] & all_cells[,1] < (2850/sqrt(npatches))*j & (2850/sqrt(npatches))*(k-1) <= all_cells[,2] & all_cells[,2] < (2850/sqrt(npatches))*k),]
      red_cells <- all_cells[ which(all_cells[,8]== 1), ]      #red cells
      filtration <- alphaComplexFiltration((red_cells[,1:2]), printProgress = TRUE)
      PH_red <-  alphaComplexDiag((red_cells[,1:2]), maxdimension = 1, library = c("GUDHI", "Dionysus"), location = TRUE)
      PD <- PH_red[["diagram"]]
      PH <- PH_red
      #lim <- c(c(712.5*(j-1), 712.5*j), c(712.5*(k-1),712.5*k))
      par(mfrow = c(1, 1))
      ones <- which(PD[,1] == 1)
      if (length(ones) > 1 ){
         #plot(NULL, type = "o", xlim = lim[1:2], ylim = lim[3:4], ylab="", xlab="", axes = FALSE)
         #points(filtration[["coordinates"]], pch = 20, cex=0.5)
             if ((nrow(red_cells) < 1800) & (nrow(red_cells) > 1700)){
                 plot(filtration[["coordinates"]], pch = 20, cex=0.5, ylab="", xlab="", axes = FALSE)
         title(main=sprintf("file %1.0f, x %1.0f y %1.0f",i, j, k)) 
                 for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 20) & (sqrt(PD[m,3]) - sqrt(PD[m,2]) <25)){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="darkorchid1", lwd=2)
                }
              } 
            } 
         }
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 25) & (sqrt(PD[m,3]) - sqrt(PD[m,2]) < 30) ){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="chartreuse3", lwd=2)
                } 
              } 
           } 
         } 
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 30) ){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="blue", lwd=2)
                } 
              } 
           } 
         } 
       }
      }  
    }
   }
  }
```


```{r HA}
par(pty="s", pch=20, cex=0.5)
#point cloud
for (i in 106:120){
  print(data_filenames[[i]])
  for (k in 1:sqrt(npatches)){ #y-axis
    for (j in 1:sqrt(npatches)){ #x-axis
      #every image is approximately 2850x2850 
      all_cells <- read.csv(file=paste0(data_file_location,data_filenames[[i]]), header=TRUE)
      all_cells <- all_cells[which( (2850/sqrt(npatches))*(j-1) <= all_cells[,1] & all_cells[,1] < (2850/sqrt(npatches))*j & (2850/sqrt(npatches))*(k-1) <= all_cells[,2] & all_cells[,2] < (2850/sqrt(npatches))*k),]
      red_cells <- all_cells[ which(all_cells[,8]== 1), ]      #red cells
      filtration <- alphaComplexFiltration((red_cells[,1:2]), printProgress = TRUE)
      PH_red <-  alphaComplexDiag((red_cells[,1:2]), maxdimension = 1, library = c("GUDHI", "Dionysus"), location = TRUE)
      PD <- PH_red[["diagram"]]
      PH <- PH_red
      #lim <- c(c(712.5*(j-1), 712.5*j), c(712.5*(k-1),712.5*k))
      par(mfrow = c(1, 1))
      ones <- which(PD[,1] == 1)
      if (length(ones) > 1 ){
         #plot(NULL, type = "o", xlim = lim[1:2], ylim = lim[3:4], ylab="", xlab="", axes = FALSE)
         #points(filtration[["coordinates"]], pch = 20, cex=0.5)
         if ((nrow(red_cells) < 2000) & (nrow(red_cells) > 1500)){
              plot(filtration[["coordinates"]], pch = 20, cex=0.5, ylab="", xlab="", axes = FALSE)
               title(main=sprintf("file %1.0f, patch x= %1.0f y= %1.0f ",i, j, k)) 
               for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
          if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 20) & (sqrt(PD[m,3]) - sqrt(PD[m,2]) < 25)){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col= "darkorchid1", lwd=2)
                } 
              } 
            } 
         }  
         for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 25) & (sqrt(PD[m,3]) - sqrt(PD[m,2]) < 30) ){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="chartreuse3", lwd=2)
                } 
              } 
           } 
         } 
        for (m in ones[1]:(length(ones)+ones[1]-1)){
            cycles <- PH[["cycleLocation"]][m]
            if ((sqrt(PD[m,3]) - sqrt(PD[m,2]) >= 30) ){
          #print(sqrt(PD[k,2]))
          #print(sqrt(PD[k,3]))
          #print(sprintf("persistence: %1.0f", sqrt(PD[k,3]) - sqrt(PD[k,2])))
              for (s in 1:length(cycles)){
                 for (l in 1:dim(cycles[[s]])[1]){
                  lines(cycles[[s]][l,,], col="blue", lwd=2)
                } 
              } 
           } 
         } 
       }
      }
    }
  }
}
```


```{r }
````
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

